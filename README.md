# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемых в приложении

Продукт
```
export interface IProduct {
    _id: string;
    title: string;
    description: string;
    image: string;
    category: string;
    price: number;
    inBasket: boolean;
}
```

Форма заказа
```
export interface IOrderForm {
	payment: string;
	address: string;
}
```

Форма контактных данных
```
export interface IContactForm {
	email: string;
	phone: string;
}
```

Данные заказа
```
export interface IOrder extends IOrderForm, IContactForm {
	items: string[];
	total: number;
}
```

Данные ошибок, используемые в формах
```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```


Данные приложения
```
export interface IAppState {
    catalog: IProduct[];
    basket: string[];
    preview: string | null;
    order: IOrder | null;
}
```

Данные подтвержденного заказа
```
export interface IOrderResult {
    id: string,
	total: number
}
```


## Архитектура приложения

Код приложения разделен на слои, согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице
- слой данных отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component
Абстрактный класс, который является родительским классам для всех компонентов приложения

Основные методы:
- `toggleClass` - отключение и включение класса в компоненте
- `setText` - установка текстового контента в компоненте
- `setDisabled` - отключение или включение компонента/кнопки
- `setHidden` - скрыть компонент
- `setVisible` - выявить компонент
- `setImage` - установить изображение и альтернативный текст изображения
- `render` - возвращает DOM элемент

#### Класс Model
Абстрактный класс, который является родительским классам для всех моделей приложения

Основные методы:
- `emitChanges` - сообщает всем об изменениях в моделе



### Слой данных

#### Класс AppData
Класс отвечает за хранение и логику работы с данными приложения
В полях класса хранятся следующие данные:
- `catalog: ProductItem[]` - данные по отдельному продукту
- `preview: string | null` - id продукта, который открывается для превью
- `formErrors: FormErrors = {}` - тексты ошибок валидации, отображаемые в формах
```
order: IOrder = {
        email: '',
        address: '',
        payment: 'online',
        phone: '',
        items: [],
        total: 0,
    }; 
- данные по заказу
```
Методы:
- `toggleProductInBasket(id: string)` - добавляет/удаляет товар в корзине
- `clearBasket()` - очищает корзину
- `validateOrder()` - валидирует форму оформления заказа
- `validateContacts()` - валидирует форму ввода контактных данных
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс ProductItem
Класс отвечает за хранение и логику работы с данными продуктов\
В полях класса хранятся следующие данные:
- `description: string;` - описание продукта
- `id: string;` - id продукта
- `image: string;` - ссылка на изображение на сервере
- `title: string;` - название продукта
- `price: number;` - цена продукта
- `category: string;` - категория продукта
- `inBasket: boolean;` - добавлен ли товар в корзину

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Отвечает за отображение главной страницы магазина.\ 
При нажатии на корзину, происходит открытие модального окна корзины
Методы:
- `_counter: HTMLElement;` - элемент счетчика корзины в шапке главной страницы
- `_catalog: HTMLElement;` - элемент галлереи карточек продуктов
- `_wrapper: HTMLElement;` - элемент обертки страницы магазина
- `_basket: HTMLElement;` - элемент значка корзины в шапке магазина
Методы:
- `set counter(value: number)` - устанавливает счетчик корзины
- `set catalog(items: HTMLElement[])` - устанавливает галлерею товаров магазина
- `set locked(value: boolean)` - блокирует прокрутку страницы. Ипользуется при открытии модального окна

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.
- `constructor(container: HTMLElement, protected events: IEvents)` Конструктор принимает контейнер, которое будет впоследующем отренедерено и экземпляр класса `EventEmitter` для возможности инициации событий.
Поля класса
- `_content: HTMLElement` - основной контент модального окна
- `_closeButton: HTMLButtonElement` - кнопка закрытия модального окна

#### Класс Form
Предназначен для реализации контента модального окна с формой содержащей поля ввода. При сабмите инициирует событие. При изменении данных в полях ввода инициирует событие изменения данных.

Поля класса:
- `_submit: HTMLButtonElement;` - кнопка перехода в окно оформления заказа
- `_errors: HTMLElement;` - элементы отображения текста ошибок валидации

Методы:
- `onInputChange(field: keyof T, value: string)` - инициализирует событие при вводе данных в поля формы
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс Basket
Предназначен для реализации контента модального окна корзины.

Поля класса:
- `_list: HTMLElement;` - элемент списка товаров, добавленных в корзину
- `_total: HTMLElement;` - элемент суммы товаров, добавленных в корзину
- `_button: HTMLElement;` - кнопка перехода в окно оформления заказа
Методы:
- сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс Success
Предназначен для реализации контента модального окна с уведомлением об успешном завершении оформления заказа\
и кнопкой перехода на главную страницу

Поля класса:
- `_close: HTMLElement;` - кнопка перехода на главную страницу
- `_total: HTMLElement;` - элемент разметки, через который выводится общая сумма заказа


#### Класс Card
Отвечает за отображение карточки продукта на главной странице, в корзине и модальном окне продукта, задавая в карточке данные названия, категории, изображения, цены. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Поля класса:
- `_title: HTMLElement;` - элемент с отображением названия продукта
- `_image?: HTMLImageElement;` - элемент с отображением изображения продукта
- `_description?: HTMLElement;` - элемент с отображением описания продукта
- `_button?: HTMLButtonElement;` - кнопка продукта, при нажатии на который происходит открытие превью продукта
- `_category?: HTMLElement;` - элемент с отображением категории продукта
- `_price: HTMLElement;` - элемент с отображением цены продукта

Методы:
- сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс CardPreview
Расширяет класс Card. Отвечает за отображение карточки продукта в превью. Конструктор получает темплейт и объект действий, которые происходят при определенных событиях. Темплейт передается в родительский класс.
Поля класса:
- `_addToBasket: HTMLButtonElement;` - кнопка добавления продукта в корзину
Методы класса: 
- `disablePriceless()` - делает кнопку добавления в корзину неактивным для бесценных товаров
- `disableIfInBasket()` - делает кнопку добавления в корзину неактивным, если товар находится в корзине

#### Класс CardBasket
Расширяет класс Card. Отвечает за отображение карточки продукта в корзине. Конструктор получает темплейт и объект действий, которые происходят при определенных событиях. Темплейт передается в родительский класс.
Поля класса:
- `_removeFromBasket: HTMLButtonElement;` - кнопка удаления продукта из корзины

#### Класс Order
Расширяет класс Form. Отвечает за отображение формы оформления заказа. При сабмите открывает окно ввода контактных данных
Поля класса:
- `_cardPayment: HTMLElement;` - кнопка выбора онлайн оплаты
- `_cashPayment: HTMLButtonElement;` - кнопка выбора оплаты наличными

#### Класс Contacts
Расширяет класс Form. Отвечает за отображение формы ввода контактных данных.\
При сабмите отправляет данные заказа на сервер. При успешном оформлении заказа открывает окно завершения заказа


### Слой коммуникации

#### Класс LarekAPI
Расширяет класс Api. В класс передается CDN, URL и тело запроса.
Основные методы, реализуемые классом описаны интерфейсом `ILarekAPI`:
- `getProductList: () => Promise<IProduct[]>;` - получение списка продуктов с сервера
- `getProductItem: (id: string) => Promise<IProduct>;` - получение отдельного продукта по id
- `orderProducts: (order: IOrder) => Promise<IOrderResult>;` - отправка заказа на сервер и получение id заказа

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\

*События изменения данных (генерируются классами моделями данных)*
- `basket:changed` - изменение данных в корзине
- `items:changed` - изменение массива товаров
- `preview:changed` - изменение карточки для превью

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `order:open` - открытие формы оформления заказа
- `order:submit` - сохранение информации из формы оформления заказа и открытие формы ввода контактных данных
- `contacts:submit` - отправка заказа на сервер
- `order.address:change` - изменение поля ввода данных
- `contacts.email:change` - изменение поля ввода данных
- `contacts.phone:change` - изменение поля ввода данных
- `order:set-cash-payment` - установка наличного метода оплаты
- `order:set-card-payment` - установка безналичного метода оплаты
- `orderErrors:change` - изменение текста ошибки формы оформления заказа
- `contactsErrors:change` - изменение текста ошибки формы ввода контактных данных
- `success:open` - открытие окна успешного оформления заказа
- `success:close` - закрытие окна успешного оформления заказа
- `card:select` - выбор карточки товара для отображения превью
- `basket:toggleProduct` - добавить или убрать продукт из корзины




